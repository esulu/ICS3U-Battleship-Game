/*
 Eren Sulutas
 05/31/2017
 ICS3U
 Summative - Game Design
 Battleship
 This program is a playable version of the board game Battleship made in Java 
 */

import java.util.Random;

class Battleship 
{
  public static void main(String[] args)
  {
    
    // Main method will act as the main connector of different methods 
    // Gives the user some options on whether they want to play or see the rulse 
    
    playGame();
  }
  
  public static void printRules()
  {
    
    // Displays the instructions on how to play the game to the user 
    
  }
  
  public static void playGame()
  {
    
    // Method where most of the gameplay will be handled  
    
    int[][] board = new int[9][9]; // Initializes an 8x8 game board
    int[][] board2 = new int[9][9];
    boolean gameEnd = false; 
    
    board = userSetup(); // Method to handle the user ship setup
    board2 = cpuSetup(board2); // Method to handle the CPU ship setup 
    printBoard(board, board2); // Displays the boad to the user 
    
    // Loops the turns of the user and the CPU until there is a winner 
    do {
      board2 = userChoice(board2);
      //board2 = cpuChoice(board);
      printBoard(board, board2);
    } while (gameEnd == false);
    
    
    
    
  }
  
  public static void printBoard(int board[][], int board2[][])
  {
    
    // Method used to print the playing board when updated 
    
    String[] numbers = {" ", "1", "2", "3", "4", "5", "6", "7", "8"};
    String[] letters = {" ", "A", "B", "C", "D", "E", "F", "G", "H"};
    
    System.out.println("      Defense\t      Offense");
    
    // Fills the boards
    for (int y = 0; y < 9; y ++) {
      for (int x = 0; x < 9; x ++){ // Board 1
        if (x == 0) { // Letters for the first column 
          System.out.print(letters[y]);
        } else if (y == 0) { // Numbers for the first row
          System.out.print(numbers[x]);
        } else if (board[y][x] == 0) { // Empty board spaces              
          System.out.print("~");
        } else if (board[y][x] == 1) { // Missed CPU shot 
          System.out.print("O");
        } else if (board[y][x] == 2) { // CPU hit 
          System.out.print("X");
        } else if (board[y][x] == 3) { // Sunken user ship
          System.out.print("|");
        } else if (board[y][x] == 4) { // User ship
          System.out.print("#");
        }
        System.out.print(" "); // Spacing 
      }
      for (int x = 0; x < 9; x ++){ // Board 2
        if (x == 0) { // Letters for the first column 
          System.out.print("\t" + letters[y]);
        } else if (y == 0) { // Numbers for the first row
          System.out.print(numbers[x]);
        } else if (board2[y][x] == 0) { // Empty board spaces              
          System.out.print("~"); 
        } else if (board2[y][x] == 1) { // Missed user shot 
          System.out.print("O");
        } else if (board2[y][x] == 2) { // User hit 
          System.out.print("X"); 
        } else if (board2[y][x] == 3) { // Sunken CPU ship
          System.out.print("|");
        } else if (board2[y][x] == 4) { //CPU ship, not seen by the yser
          System.out.print("a");
        }
        System.out.print(" "); // Spacing   
      }
      System.out.println(); // New lines 
    } 
    
  }
  
  public static int[][] userSetup() //void userSetup()
  {
    
    // Method where the user makes their initial ship setup 
    int[][] board = new int[9][9];
    int[] entry0 = new int[3]; // Arrays to hold the inital coordinates of the ships 
    int[] entry1 = new int[3];
    int[] entry2 = new int[3];
    int[] entry3 = new int[3];
    int shipSize;
    
    System.out.println("\nShip placements: ");
    System.out.println("The coordinate you enter will be the upper left of the ship.");
    System.out.println("Entry must be entered in the following format: <(V)ertical/(H)orizontal> <Y-Axis> <X-Axis> Examples: VC5, HG5");
    
    System.out.println("Enter the coordinates to place your Aircraft Carrier (1x5). Ex: HA4");
    entry0 = lettersToIntSetup(); // User entry is handled in the lettersToIntSetup method 
    shipSize = 5; // Indicates the ship size (in this case 5 long)
    
    board = setupUserError(entry0, board, shipSize); // Sends some variables to the setupUserError method to check if the ship is illegally placed 
    
    System.out.println("Enter the coordinates to place your Battleship (1x4). Ex: HA4");
    entry1 = lettersToIntSetup(); // User entry is handled in the lettersToIntSetup method 
    shipSize = 4; // Indicates the ship size (in this case 4 long)
    
    board = setupUserError(entry1, board, shipSize); // Sends some variables to the setupUserError method to check if the ship is illegally placed 
    
    System.out.println("Enter the coordinates to place your Submarine (1x3). Ex: HA4");
    entry2 = lettersToIntSetup(); // User entry is handled in the lettersToIntSetup method 
    shipSize = 3; // Indicates the ship size (in this case 3 long)
    
    board = setupUserError(entry2, board, shipSize); // Sends some variables to the setupUserError method to check if the ship is illegally placed 
    
    System.out.println("Enter the coordinates to place your Patrol Boat (1x2). Ex: HA4");
    entry3 = lettersToIntSetup(); // User entry is handled in the lettersToIntSetup method 
    shipSize = 2; // Indicates the ship size (in this case 2 long)
    
    board = setupUserError(entry3, board, shipSize); // Sends some variables to the setupUserError method to check if the ship is illegally placed 
    
    return board;
    
  }
  
  public static int[] lettersToIntSetup()
  {
    
    // Method to convert the ship setup coordinate values to integers 
    
    String input;
    boolean validEntry = false;
    int y = 0; 
    int x = 0;
    int[] coordinates = new int[3];
    
    do {
      input = In.getString(); // User input 
      if (input.length() == 3) { // Checks if the input is 3 characters long 
        char position = input.charAt(0);
        char yChar = input.charAt(1);
        char xChar = input.charAt(2);
        position = Character.toLowerCase(position);
        yChar = Character.toLowerCase(yChar);
        if ((position == 'v' || position == 'h') && (yChar >= 'a' && yChar <= 'h') && (xChar >= '1' && xChar <= '8')) { // Checks if the user entered a v/h position,  the y-coordinate is a letter from a-h and if the x-coordinate is a number from 1-8
          // Checks if the user entered a veritical position 
          if (position == 'v') { 
            coordinates[0] = 1;
          } else { // User entered a horizontal position
            coordinates[0] = 2;
          }
          y = yChar - 'a' + 1; // Converts the y char value to an int
          x = Character.getNumericValue(xChar); // Converts the x char value to an int 
          validEntry = true;
        } else { // Invalid input 
          System.out.println("Error: Invalid coordinates. Please enter new coordinates. Ex: HA4");
        }
      } else { // Entry is not 3 characters long 
        System.out.println("Error: Entry must be 3 characters long. Please enter new coordinates. Ex: VH6");
      }
    } while (validEntry == false);  // Loops until the user enters a valid coordinate
    
    coordinates[1] = y;
    coordinates[2] = x;
    
    return coordinates;
    
    
  }
  
  public static int[][] setupUserError(int[] entry, int[][] board, int shipSize)
  {
    
    // Method which checks if user boats overlap or are placed in invalid locations
    boolean added = false; 
    
    // Loops until the ship has been added 
    while(!added) {
      
      if (entry[0] == 2) {  // Checks for available horizontal space for the ship
        
        boolean hasSpace = true;
        
        for (int i = 0; i < shipSize; i ++) {
          // Checks if the ship fits on the board horizontally (Does not go out of bounds)
          if (entry[2] + i >= 9) {
            // Ship goes out of the board 
            hasSpace = false;
            System.out.println("Error: Ship cannot go out of the board. Enter a new input. Ex: HB7");
            entry = lettersToIntSetup(); // User enters a new input 
            break; 
          }
          if (board[entry[1]][entry[2]+i] != 0) {
            // Checks if this area is occupied by another ship
            hasSpace = false;
            System.out.println("Error: Ships cannot overlap. Enter a new input. Ex: HB7");
            entry = lettersToIntSetup(); // User enters a new input 
            break;
          }
        }
        if (!hasSpace) { 
          // No space found, checks again 
          continue;
        } 
        for (int i = 0; i < shipSize; i++) {
          board[entry[1]][entry[2]+i] = 4; // Sets the position values to 4 which indicates a ship
        }
        added = true;
        
      } else {  // Checks for available veritical space for the ship
        
        boolean hasSpace = true;
        
        for (int i = 0; i < shipSize; i++) {
          // Checks if the ship fits on the board vertically (Does not go out of bounds)
          if (entry[1] + i >= 9) { 
            // Ship goes out of the board 
            hasSpace = false;
            System.out.println("Error: Ship cannot go out of the board. Enter a new input. Ex: HB7");
            entry = lettersToIntSetup(); // User enters a new input 
            break;
          }
          if (board[entry[1]+i][entry[2]] != 0) {
            // Checks if this area is occupied by another ship
            hasSpace = false;
            System.out.println("Error: Ships cannot overlap. Enter a new input. Ex: HB7");
            entry = lettersToIntSetup(); // User enters a new input 
            break;
          }
        }
        if (!hasSpace) {
          // No space found, checks again 
          continue;
        }
        for (int i = 0; i < shipSize; i++) {
          board[entry[1]+i][entry[2]] = 4; // Sets the position values to 4 which indicates a ship
        }
        added = true;
      }
    }
    
    return board;
    
  }
  
  public static int[][] cpuSetup(int[][] board)
  {
    
    // Method where the computer makes their initial ship setup 
    int[] shipSize = {5, 4, 3, 2}; // Array for the ship sizes 
    
    for (int ship : shipSize) { // Loop continues for each ship 
      
      boolean added = false; 
      
      // Loops until the ship has been added 
      while (!added) {
        Random generate = new Random();
        
        // Generates random numbers for the x and y values 
        int x = (generate.nextInt(7)) + 1;
        int y = (generate.nextInt(7)) + 1;
        
        // Genterates eitehr 0 or 1 to determine if the ship is horizontal or vertical 
        int direction = generate.nextInt(2); 
        boolean horizontal = false;
        
        // Checks if the direction is horizontal 
        if (direction == 0) {
          horizontal = true;
        }
        
        if (horizontal) { // Checks for available space if the ship is horizontal 
          
          boolean hasSpace = true;
          
          for (int i = 0; i < ship; i ++) { 
            
            // Checks if the ship fits on the board horizontally (Does not go out of bounds)
            if (x + i >= 9) {
              // Ship goes out of the board 
              hasSpace = false;
              break;
            }
            if (board[y][x+i] != 0) {
              // Checks if this area is occupied by another ship
              hasSpace = false;
              break;
            }
          }
          if (!hasSpace) { 
            // No space found, checks again 
            continue;
          }
          for (int i = 0; i < ship; i++) {
            board[y][x+i] = 4; // Sets the position values to 4 which indicates a ship
          }
          added = true;
          
        } else { // Ship is placed vertically 
          
          boolean hasSpace = true; 
          
          for (int i = 0; i < ship; i ++) { 
            
            // Checks if the ship fits on the board vertically (Does not go out of bounds)
            if (y + i >= 9) { 
              // Ship goes out of the board 
              hasSpace = false;
              break;
            }
            if (board[y+i][x] != 0) {
              // Checks if this area is occupied by another ship
              hasSpace = false;
              break;
            }
          }
          if (!hasSpace) { 
            // No space found, checks again 
            continue;
          }
          for (int i = 0; i < ship; i++) {
            board[y+i][x] = 4; // Sets the position values to 4 which indicates a ship
          }
          added = true;
        }
      }
    }
    
    return board;
    
  }
  
  public static int[][] userChoice(int[][] board)
  {
    
    // Method which handles the user choice of attack
    
    int [] coordinates = new int[2];
    boolean isValid = false;
    
    do { 
      
      System.out.println("Enter the coordinates you wish to shoot. Ex: B4");
      coordinates = lettersToInt(); // User entry is handled in the lettersToInt method 
      
      if (board[coordinates[0]][coordinates[1]] != 0 && board[coordinates[0]][coordinates[1]] != 4) { // The cell is occupied 
        System.out.println("Error: The coordinates have already been entered. Enter new coordinates.");
      } else { // The cell is unoccupied 
        isValid = true;
        // Checks if the user missed, hit, or sunk a ship 
        if (board[coordinates[0]][coordinates[1]] == 0) { // Miss
          System.out.println("Miss!");
          board[coordinates[0]][coordinates[1]] = 1; 
        } else if (board[coordinates[0]][coordinates[1]] == 4) { // Hit 
          System.out.println("Hit!");
          board[coordinates[0]][coordinates[1]] = 2;
        }
      }
    } while (isValid == false); // Loops until the user enters a valid cell 
    
    return board;
    
  }
  public static void d()// int cpuChoice()
  {
    
    // Method which handles the computer choice of attack 
    
  }
  
  public static int[] lettersToInt()
  {
    
    // Method to convert the coordinate values to integers for the user 
    
    String input;
    boolean validEntry = false;
    int y = 0; 
    int x = 0;
    int[] coordinates = new int[2];
    
    do {
      input = In.getString(); // User input 
      
      if (input.length() == 2) { // Checks if the entry is two characters long 
        do {
          char yChar = input.charAt(0);
          char xChar = input.charAt(1);
          yChar = Character.toLowerCase(yChar);
          if ((yChar >= 'a' && yChar <= 'h') && (xChar >= '1' && xChar <= '8')) { // Checks if the input is only 2 characters long, the y-coordinate is a letter from a-h and if the x-coordinate is a number from 1-8
            y = yChar - 'a' + 1; // Converts the y char value to an inth
            x = Character.getNumericValue(xChar); // Converts the x char value to an int 
            validEntry = true;
          } else { // Invalid input 
            System.out.println("Error: Invalid coordinates. Please enter new coordinates. Ex: A4");
          }
        } while (validEntry == false);  // Loops until the user enters a valid coordinate
      } else {
        // Entry is not 2 characters long 
        System.out.println("Error: Entry must be 2 characters long. Please enter new coordinates. Ex: H7. ");
      }
    } while (input.length() != 2);
    
    coordinates[0] = y;
    coordinates[1] = x;
    
    return coordinates;
    
    
  }
  
  public static void printScore()
  {
    
    // Method used to display the score 
    
  }
  
}
